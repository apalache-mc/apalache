<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Type Checker Tutorial - Apalache Documentation</title>
        
        


        <!-- Custom HTML head -->
        


        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        
        <link rel="icon" href="../favicon.svg">
        
        
        <link rel="shortcut icon" href="../favicon.png">
        
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        
        <link rel="stylesheet" href="../css/print.css" media="print">
        

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        
        <link rel="stylesheet" href="../fonts/fonts.css">
        

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        

        
        <!-- MathJax -->
        <script async type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
        
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="../index.html">Overview</a></li><li class="chapter-item expanded affix "><li class="part-title">Tutorials</li><li class="chapter-item expanded "><a href="../tutorials/index.html"><strong aria-hidden="true">1.</strong> Overview</a></li><li class="chapter-item expanded "><a href="../tutorials/entry-tutorial.html"><strong aria-hidden="true">2.</strong> Entry-level Model Checker Tutorial</a></li><li class="chapter-item expanded "><a href="../tutorials/snowcat-tutorial.html" class="active"><strong aria-hidden="true">3.</strong> Type Checker Tutorial</a></li><li class="chapter-item expanded "><a href="../tutorials/pluscal-tutorial.html"><strong aria-hidden="true">4.</strong> Checking Pluscal specifications</a></li><li class="chapter-item expanded "><a href="../tutorials/trail-tips.html"><strong aria-hidden="true">5.</strong> Apalache trail tips: how to check your specs faster</a></li><li class="chapter-item expanded "><a href="../tutorials/symbmc.html"><strong aria-hidden="true">6.</strong> Symbolic Model Checking</a></li><li class="chapter-item expanded "><a href="../tutorials/temporal-properties.html"><strong aria-hidden="true">7.</strong> Specifying temporal properties and understanding counterexamples</a></li><li class="chapter-item expanded affix "><li class="part-title">HOWTOs</li><li class="chapter-item expanded "><a href="../HOWTOs/index.html"><strong aria-hidden="true">8.</strong> Overview</a></li><li class="chapter-item expanded "><a href="../HOWTOs/howto-write-type-annotations.html"><strong aria-hidden="true">9.</strong> How to write type annotations</a></li><li class="chapter-item expanded "><a href="../HOWTOs/uninterpretedTypes.html"><strong aria-hidden="true">10.</strong> How to use uninterpreted types</a></li><li class="chapter-item expanded affix "><li class="part-title">Apalache User Manual</li><li class="chapter-item expanded "><a href="../apalache/index.html"><strong aria-hidden="true">11.</strong> Getting Started</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../apalache/installation/index.html"><strong aria-hidden="true">11.1.</strong> Installation</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../apalache/installation/jvm.html"><strong aria-hidden="true">11.1.1.</strong> Prebuilt Packages</a></li><li class="chapter-item expanded "><a href="../apalache/installation/docker.html"><strong aria-hidden="true">11.1.2.</strong> Docker</a></li><li class="chapter-item expanded "><a href="../apalache/installation/source.html"><strong aria-hidden="true">11.1.3.</strong> Build from Source</a></li></ol></li><li class="chapter-item expanded "><a href="../apalache/running.html"><strong aria-hidden="true">11.2.</strong> Running the Tool</a></li><li class="chapter-item expanded "><a href="../apalache/example.html"><strong aria-hidden="true">11.3.</strong> An Example TLA+ Specification</a></li><li class="chapter-item expanded "><a href="../apalache/parameters.html"><strong aria-hidden="true">11.4.</strong> Specification Parameters</a></li><li class="chapter-item expanded "><a href="../apalache/principles/index.html"><strong aria-hidden="true">11.5.</strong> Symbolic Model Checking with Apalache</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../apalache/principles/assignments.html"><strong aria-hidden="true">11.5.1.</strong> Assignments and symbolic transitions</a></li><li class="chapter-item expanded "><a href="../apalache/principles/folds.html"><strong aria-hidden="true">11.5.2.</strong> Folding sets and sequences</a></li><li class="chapter-item expanded "><a href="../apalache/principles/invariants.html"><strong aria-hidden="true">11.5.3.</strong> Invariants: State, Action, Trace</a></li><li class="chapter-item expanded "><a href="../apalache/principles/enumeration.html"><strong aria-hidden="true">11.5.4.</strong> Enumeration of counterexamples</a></li><li class="chapter-item expanded "><a href="../apalache/principles/apalache-mod.html"><strong aria-hidden="true">11.5.5.</strong> The Apalache Module</a></li><li class="chapter-item expanded "><a href="../apalache/principles/naturals.html"><strong aria-hidden="true">11.5.6.</strong> Naturals</a></li></ol></li><li class="chapter-item expanded "><a href="../apalache/config.html"><strong aria-hidden="true">11.6.</strong> Apalache global configuration file</a></li><li class="chapter-item expanded "><a href="../apalache/statistics.html"><strong aria-hidden="true">11.7.</strong> TLA+ Execution Statistics</a></li><li class="chapter-item expanded "><a href="../apalache/profiling.html"><strong aria-hidden="true">11.8.</strong> Profiling Your Specification</a></li><li class="chapter-item expanded "><a href="../apalache/theory.html"><strong aria-hidden="true">11.9.</strong> Five minutes of theory</a></li></ol></li><li class="chapter-item expanded "><a href="../apalache/tlc-config.html"><strong aria-hidden="true">12.</strong> TLC Configuration Files</a></li><li class="chapter-item expanded "><a href="../apalache/typechecker-snowcat.html"><strong aria-hidden="true">13.</strong> The Snowcat Type Checker</a></li><li class="chapter-item expanded "><a href="../apalache/features.html"><strong aria-hidden="true">14.</strong> Supported Features</a></li><li class="chapter-item expanded "><a href="../apalache/principles/recursive.html"><strong aria-hidden="true">15.</strong> Obsolete: Recursive operators and functions</a></li><li class="chapter-item expanded "><a href="../apalache/known-issues.html"><strong aria-hidden="true">16.</strong> Known Issues</a></li><li class="chapter-item expanded "><a href="../apalache/antipatterns.html"><strong aria-hidden="true">17.</strong> Antipatterns</a></li><li class="chapter-item expanded "><a href="../apalache/preprocessing.html"><strong aria-hidden="true">18.</strong> TLA+ Preprocessing</a></li><li class="chapter-item expanded "><a href="../apalache/tuning.html"><strong aria-hidden="true">19.</strong> Fine Tuning</a></li><li class="chapter-item expanded "><a href="../apalache/assignments-in-depth.html"><strong aria-hidden="true">20.</strong> Assignments and Symbolic Transitions in Depth</a></li><li class="chapter-item expanded "><a href="../apalache/kera.html"><strong aria-hidden="true">21.</strong> KerA: kernel logic of actions</a></li><li class="chapter-item expanded affix "><li class="part-title">TLA+ Language Manual for Engineers</li><li class="chapter-item expanded "><a href="../lang/index.html"><strong aria-hidden="true">22.</strong> Introduction</a></li><li class="chapter-item expanded "><a href="../lang/standard-operators.html"><strong aria-hidden="true">23.</strong> The standard operators of TLA+</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../lang/booleans.html"><strong aria-hidden="true">23.1.</strong> Booleans</a></li><li class="chapter-item expanded "><a href="../lang/control-and-nondeterminism.html"><strong aria-hidden="true">23.2.</strong> Control And Nondeterminism</a></li><li class="chapter-item expanded "><a href="../lang/conditionals.html"><strong aria-hidden="true">23.3.</strong> Conditionals</a></li><li class="chapter-item expanded "><a href="../lang/integers.html"><strong aria-hidden="true">23.4.</strong> Integers</a></li><li class="chapter-item expanded "><a href="../lang/sets.html"><strong aria-hidden="true">23.5.</strong> Sets</a></li><li class="chapter-item expanded "><a href="../lang/logic.html"><strong aria-hidden="true">23.6.</strong> Logic</a></li><li class="chapter-item expanded "><a href="../lang/functions.html"><strong aria-hidden="true">23.7.</strong> Functions</a></li><li class="chapter-item expanded "><a href="../lang/records.html"><strong aria-hidden="true">23.8.</strong> Records</a></li><li class="chapter-item expanded "><a href="../lang/tuples.html"><strong aria-hidden="true">23.9.</strong> Tuples</a></li><li class="chapter-item expanded "><a href="../lang/sequences.html"><strong aria-hidden="true">23.10.</strong> Sequences</a></li><li class="chapter-item expanded "><div><strong aria-hidden="true">23.11.</strong> Bags</div></li></ol></li><li class="chapter-item expanded "><a href="../lang/apalache-extensions.html"><strong aria-hidden="true">24.</strong> Apalache extensions</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../lang/apalache-operators.html"><strong aria-hidden="true">24.1.</strong> Apalache module</a></li><li class="chapter-item expanded "><a href="../lang/variants.html"><strong aria-hidden="true">24.2.</strong> Variants</a></li><li class="chapter-item expanded "><a href="../lang/option-types.html"><strong aria-hidden="true">24.3.</strong> Option types</a></li></ol></li><li class="chapter-item expanded "><a href="../lang/user-operators.html"><strong aria-hidden="true">25.</strong> User-defined operators</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../lang/user/top-level-operators.html"><strong aria-hidden="true">25.1.</strong> Top-level operator definitions</a></li><li class="chapter-item expanded "><a href="../lang/user/let-in.html"><strong aria-hidden="true">25.2.</strong> LET-IN definitions</a></li><li class="chapter-item expanded "><a href="../lang/user/higher-order-operators.html"><strong aria-hidden="true">25.3.</strong> Higher-order operators definitions</a></li><li class="chapter-item expanded "><a href="../lang/user/lambdas.html"><strong aria-hidden="true">25.4.</strong> Anonymous operator definitions</a></li><li class="chapter-item expanded "><a href="../lang/user/local-operators.html"><strong aria-hidden="true">25.5.</strong> Local operator definitions</a></li></ol></li><li class="chapter-item expanded "><div><strong aria-hidden="true">26.</strong> Modules, Extends, and Instances</div></li><li class="chapter-item expanded affix "><li class="part-title">Idiomatic TLA+</li><li class="chapter-item expanded "><a href="../idiomatic/index.html"><strong aria-hidden="true">27.</strong> Introduction</a></li><li class="chapter-item expanded "><a href="../idiomatic/000keep-minimum-state-variables.html"><strong aria-hidden="true">28.</strong> Keep state variables to the minimum</a></li><li class="chapter-item expanded "><a href="../idiomatic/001assignments.html"><strong aria-hidden="true">29.</strong> Update state variables with assignments</a></li><li class="chapter-item expanded "><a href="../idiomatic/002primes.html"><strong aria-hidden="true">30.</strong> Apply primes only to state variables</a></li><li class="chapter-item expanded "><a href="../idiomatic/007if-then-else.html"><strong aria-hidden="true">31.</strong> Use Boolean operators in actions, not IF-THEN-ELSE</a></li><li class="chapter-item expanded "><a href="../idiomatic/003record-sets.html"><strong aria-hidden="true">32.</strong> Avoid sets of mixed records</a></li><li class="chapter-item expanded affix "><li class="part-title">Design Documents</li><li class="chapter-item expanded "><a href="../adr/001rfc-types.html"><strong aria-hidden="true">33.</strong> RFC 001: types and type annotations</a></li><li class="chapter-item expanded "><a href="../adr/002adr-types.html"><strong aria-hidden="true">34.</strong> ADR-002: types and type annotations</a></li><li class="chapter-item expanded "><a href="../adr/003adr-trex.html"><strong aria-hidden="true">35.</strong> ADR-003: transition executor (TRex)</a></li><li class="chapter-item expanded "><a href="../adr/004adr-annotations.html"><strong aria-hidden="true">36.</strong> ADR-004: code annotations</a></li><li class="chapter-item expanded "><a href="../adr/005adr-json.html"><strong aria-hidden="true">37.</strong> ADR-005: JSON Serialization Format</a></li><li class="chapter-item expanded "><a href="../adr/006rfc-unit-testing.html"><strong aria-hidden="true">38.</strong> RFC-006: unit tests and property-based tests</a></li><li class="chapter-item expanded "><a href="../adr/007adr-restructuring.html"><strong aria-hidden="true">39.</strong> ADR-007: restructuring</a></li><li class="chapter-item expanded "><a href="../adr/008adr-exceptions.html"><strong aria-hidden="true">40.</strong> ADR-008: exceptions</a></li><li class="chapter-item expanded "><a href="../adr/009adr-outputs.html"><strong aria-hidden="true">41.</strong> ADR-009: outputs</a></li><li class="chapter-item expanded "><a href="../adr/010rfc-transition-explorer.html"><strong aria-hidden="true">42.</strong> RFC-010: Implementation of Transition Exploration Server</a></li><li class="chapter-item expanded "><a href="../adr/011adr-smt-arrays.html"><strong aria-hidden="true">43.</strong> ADR-011: alternative SMT encoding using arrays</a></li><li class="chapter-item expanded "><a href="../adr/012adr-adopt-adr-template.html"><strong aria-hidden="true">44.</strong> ADR-012: Adopt an ADR Template</a></li><li class="chapter-item expanded "><a href="../adr/013adr-configuration.html"><strong aria-hidden="true">45.</strong> ADR-013: Configuration Management Component</a></li><li class="chapter-item expanded "><a href="../adr/014adr-precise-records.html"><strong aria-hidden="true">46.</strong> ADR-014: Precise type inference for records and variants</a></li><li class="chapter-item expanded "><a href="../adr/015adr-trace.html"><strong aria-hidden="true">47.</strong> ADR-015: ITF: informal trace format</a></li><li class="chapter-item expanded "><a href="../adr/016adr-retla.html"><strong aria-hidden="true">48.</strong> ADR-016: ReTLA: Relational TLA</a></li><li class="chapter-item expanded "><a href="../adr/017pdr-temporal.html"><strong aria-hidden="true">49.</strong> PDR-017: Checking temporal properties</a></li><li class="chapter-item expanded "><a href="../adr/018adr-inlining.html"><strong aria-hidden="true">50.</strong> ADR-018: Inlining in Apalache</a></li><li class="chapter-item expanded "><a href="../adr/019adr-harmonize-changelog.html"><strong aria-hidden="true">51.</strong> ADR-019: Harmonize changelog management</a></li><li class="chapter-item expanded "><a href="../adr/020adr-arenas.html"><strong aria-hidden="true">52.</strong> ADR-020: Improving membership in arenas</a></li><li class="chapter-item expanded "><a href="../adr/021rfc-prioritization.html"><strong aria-hidden="true">53.</strong> RFC-021: Prioritization of Work</a></li><li class="chapter-item expanded "><a href="../adr/022adr-unification-of-configs-and-options.html"><strong aria-hidden="true">54.</strong> ADR-022: Unify Configuration Management and &quot;Pass Options&quot;</a></li><li class="chapter-item expanded "><a href="../adr/023adr-trace-evaluation.html"><strong aria-hidden="true">55.</strong> ADR-023: Trace evaluation</a></li><li class="chapter-item expanded "><a href="../adr/024adr-arena-pass.html"><strong aria-hidden="true">56.</strong> ADR-024: Arena computation isolation</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                        
                    </div>

                    <h1 class="menu-title">Apalache Documentation</h1>

                    <div class="right-buttons">
                        
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        
                        
                        <a href="https://github.com/informalsystems/apalache" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>
                        
                    </div>
                </div>

                
                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" name="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1><a class="header" href="#tutorial-on-the-snowcat-type-checker" id="tutorial-on-the-snowcat-type-checker">Tutorial on the Snowcat❄🐱 Type Checker</a></h1>
<p><strong>Difficulty: Blue trail – Easy</strong></p>
<p><strong>Revision:</strong> August 24, 2022</p>
<p>In this tutorial, we introduce the Snowcat ❄ 🐱 type checker.
We give concrete steps to running the type checker and annotating a specification
with types.</p>
<p>This tutorial uses Type System 1.2, which guarantees safe record access. To see
how to upgrade to Type System 1.2, check <a href="../HOWTOs/howto-write-type-annotations.html#recipe9">Migrating to Type System 1.2</a>.</p>
<h2><a class="header" href="#related-documents" id="related-documents">Related documents</a></h2>
<ul>
<li><a href="../adr/002adr-types.html">ADR002</a> that introduces Type Systems 1 and 1.2, used by Snowcat.</li>
<li>A more technical <a href="../HOWTOs/howto-write-type-annotations.html">HOWTO on writing type annotations</a>.</li>
<li><a href="../adr/004adr-annotations.html">ADR004</a> that introduces Java-like annotations in TLA+ comments.</li>
</ul>
<h2><a class="header" href="#setup" id="setup">Setup</a></h2>
<p>We assume that you have Apalache installed. If not, check the manual page on
<a href="../apalache/installation/index.html">Apalache installation</a>. The minimal required version is 0.29.0.</p>
<h2><a class="header" href="#running-example-lamports-mutex" id="running-example-lamports-mutex">Running example: Lamport's mutex</a></h2>
<p>As a running example, we are using the specification of <a href="https://github.com/tlaplus/Examples/blob/master/specifications/lamport_mutex">Lamport's Mutex</a>
(written by <a href="https://members.loria.fr/Stephan.Merz/">Stephan Merz</a>). We recommend to reproduce the steps in this
tutorial. So, go ahead and download the specification file
<a href="https://github.com/tlaplus/Examples/blob/master/specifications/lamport_mutex/LamportMutex.tla">LamportMutex.tla</a>. We will add type annotations to this file. Let's rename
<code>LamportMutex.tla</code> to <code>LamportMutexTyped.tla</code>.</p>
<h2><a class="header" href="#step-1-running-snowcat" id="step-1-running-snowcat">Step 1: Running Snowcat</a></h2>
<p>Before we start writing any type annotations, let's run the type checker and
see, whether it complains:</p>
<pre><code class="language-sh">$ apalache-mc typecheck LamportMutexTyped.tla
</code></pre>
<p>The tool output is a bit verbose. Below, you can see the important lines of the
output:</p>
<pre><code>...
PASS #1: TypeCheckerSnowcat
 &gt; Running Snowcat .::.                                           
Typing input error: Expected a type annotation for VARIABLE clock
... 
</code></pre>
<h2><a class="header" href="#step-2-annotating-variables-clock-req-ack-crit" id="step-2-annotating-variables-clock-req-ack-crit">Step 2: Annotating variables clock, req, ack, crit</a></h2>
<p>In Step 1, Snowcat complained about the name <code>clock</code>. The reason
for that is very simple: <code>clock</code> is declared as a variable, but Snowcat 
does not find a type annotation for it.</p>
<p>The comment next to the declaration of <code>clock</code> does not tell us precisely
what <code>clock</code> should be:</p>
<pre><code>  clock,    \* local clock of each process
</code></pre>
<p>Let's dig a bit further and check <code>TypeOK</code>, which is usually a good source of
type hints in untyped specifications:</p>
<pre><code class="language-tla">TypeOK ==
     (* clock[p] is the local clock of process p *)
  /\ clock \in [Proc -&gt; Clock]
     (* req[p][q] stores the clock associated with request from q received by p, 0 if none *)
  /\ req \in [Proc -&gt; [Proc -&gt; Nat]]
     (* ack[p] stores the processes that have ack'ed p's request *)
  /\ ack \in [Proc -&gt; SUBSET Proc]
     (* network[p][q]: queue of messages from p to q -- pairwise FIFO communication *)
  /\ network \in [Proc -&gt; [Proc -&gt; Seq(Message)]]
     (* set of processes in critical section: should be empty or singleton *)
  /\ crit \in SUBSET Proc
</code></pre>
<p>This is better, but we have to figure out the types of <code>Proc</code> and <code>Clock</code>.
Let's have a look at their definitions.</p>
<pre><code class="language-tla">Proc == 1 .. N
Clock == Nat \ {0}
</code></pre>
<p>From the definitions of <code>Proc</code> and <code>Clock</code>, it is clear that they are both
subsets of integers. We could annotate these two definitions with the type
<code>Set(Int)</code>, but this is not necessary, since Snowcat will infer these types
itself.</p>
<p>Together with <code>TypeOK</code>, this gives us enough information to annotate all but
one variable (we will annotate the variable <code>network</code> later):</p>
<pre><code class="language-tla">VARIABLES
  \* @type: Int -&gt; Int;
  clock,    \* local clock of each process
  \* @type: Int -&gt; (Int -&gt; Int);
  req,      \* requests received from processes (clock transmitted with request)
  \* @type: Int -&gt; Set(Int);
  ack,      \* acknowledgements received from processes
  \* @type: Set(Int);
  crit,     \* set of processes in critical section
</code></pre>
<p>In our type annotations:</p>
<ul>
<li>
<p><code>clock</code> belongs to the set <code>[Proc -&gt; Clock]</code>. Hence, it is a function of
integers to integers, that is, <code>Int -&gt; Int</code>.</p>
</li>
<li>
<p><code>req</code> belongs to the set <code>[Proc -&gt; [Proc -&gt; Nat]]</code>. Hence, it is a function
of integers to functions of integers to integers, that is, <code>Int -&gt; (Int -&gt; Int)</code>.</p>
</li>
<li>
<p><code>ack</code> belongs to the set <code>[Proc -&gt; SUBSET Proc]</code>. Hence, it is a function of
integers to sets of integers, that is, <code>Int -&gt; Set(Int)</code>.</p>
</li>
<li>
<p><code>crit</code> is a subset of <code>Proc</code>, so it is a set of integers, that is,
<code>Set(Int)</code>.</p>
</li>
</ul>
<p><strong>Note</strong>: We place the annotation for <code>clock</code> between the keyword <code>VARIABLES</code>
and <code>clock</code>, not before the keyword <code>VARIABLES</code>. Similarly, we added a type
annotation immediately above every other variable name.</p>
<p>We used the one-line TLA+ comment for <code>clock</code>:</p>
<pre><code class="language-tla">\* @type: Int -&gt; Int;
</code></pre>
<p>Alternatively, we could use the multi-line comment:</p>
<pre><code class="language-tla">(*
 Clock is a function of integers to integers.

 @type: Int -&gt; Int;
 *)
</code></pre>
<p><strong>Note</strong>: Importantly, every type annotation must end with a semicolon <code>;</code>.</p>
<p>Let's run the type checker again:</p>
<pre><code class="language-sh">$ apalache-mc typecheck LamportMutexTyped.tla
...
Typing input error: Expected a type annotation for VARIABLE network
</code></pre>
<p>Not surprisingly, the type checker tells us that we still have to annotate the
variable <code>network</code>.</p>
<h2><a class="header" href="#step-3-annotating-the-variable-network" id="step-3-annotating-the-variable-network">Step 3: Annotating the variable network</a></h2>
<p>Let's have a look at the operator <code>TypeOK</code> again:</p>
<pre><code class="language-tla">TypeOK ==
     (* clock[p] is the local clock of process p *)
  /\ clock \in [Proc -&gt; Clock]
     (* req[p][q] stores the clock associated with request from q received by p, 0 if none *)
  /\ req \in [Proc -&gt; [Proc -&gt; Nat]]
     (* ack[p] stores the processes that have ack'ed p's request *)
  /\ ack \in [Proc -&gt; SUBSET Proc]
     (* network[p][q]: queue of messages from p to q -- pairwise FIFO communication *)
  /\ network \in [Proc -&gt; [Proc -&gt; Seq(Message)]]
     (* set of processes in critical section: should be empty or singleton *)
  /\ crit \in SUBSET Proc
</code></pre>
<p>From this we can see that <code>network</code> is a function of integers to a function of
integers to a sequence of messages. So its type should look like:</p>
<pre><code class="language-tla">Int -&gt; (Int -&gt; Seq(/* message type */))
</code></pre>
<p>But what is the message type? To find out, we have to continue our archaeology
trip and check the definition of <code>Message</code> and related operators:</p>
<pre><code class="language-tla">ReqMessage(c) == [type |-&gt; &quot;req&quot;, clock |-&gt; c]
AckMessage == [type |-&gt; &quot;ack&quot;, clock |-&gt; 0]
RelMessage == [type |-&gt; &quot;rel&quot;, clock |-&gt; 0]

Message == {AckMessage, RelMessage} \union {ReqMessage(c) : c \in Clock}
</code></pre>
<p>From these four definitions, we can see that <code>Messages</code> is a set of records
that have two fields: the field <code>type</code> that should be a string, and the field
<code>clock</code> that should be an integer. In Apalache, we write such a record type as:</p>
<pre><code class="language-tla">{ type: Str, clock: Int }
</code></pre>
<p>Hence, the type of <code>network</code> should be:</p>
<pre><code class="language-tla">Int -&gt; (Int -&gt; Seq({ type: Str, clock: Int }))
</code></pre>
<p>We could write it as above, but that type is a bit hard to read. Hence, we
split it into two parts: the type alias <code>message</code> that defines the type of
messages, and the type of <code>network</code> that refers to the type alias <code>message</code>.
This can be done in the following way:</p>
<pre><code class="language-tla">  \* @typeAlias: message = {
  \*     type: Str,
  \*     clock: Int
  \* };
  \* @type: Int -&gt; (Int -&gt; Seq($message));
  network   \* messages sent but not yet received
</code></pre>
<p><strong>Note:</strong> We are lucky that <code>ReqMessage</code>, <code>AckMessage</code>, and <code>RelMessage</code> are
producing records of the same shape. In some specifications, the shapes of
records differ, while these records should be added to the same set. This is a
bit problematic for the type checker, as it expects set elements to have the
same type. In this case, we have three options:</p>
<ul>
<li>
<p>Slightly rewrite the specification to homogenize records,</p>
</li>
<li>
<p>Partition the set of messages into several sets, see <a href="../idiomatic/003record-sets.html">Idiom 15</a>, or</p>
</li>
<li>
<p>Use variants. This is a more advanced topic, see the
<a href="../HOWTOs/howto-write-type-annotations.html">HOWTO on writing type annotations</a>.</p>
</li>
</ul>
<p>Now we should run the type checker again:</p>
<pre><code class="language-sh">$ apalache-mc typecheck LamportMutexTyped.tla
...
Typing input error: Expected a type annotation for CONSTANT maxClock
</code></pre>
<p>The type checker is still not happy: We have not annotated <code>CONSTANTS</code>.</p>
<h2><a class="header" href="#step-4-annotating-constants" id="step-4-annotating-constants">Step 4: Annotating constants</a></h2>
<p>Now we have to figure out the types of the constants: <code>N</code> and <code>maxClock</code>.  This
is fairly easy, as these constants are accompanied by the two assumptions:</p>
<pre><code class="language-tla">ASSUME NType == N \in Nat
ASSUME maxClockType == maxClock \in Nat
</code></pre>
<p>From these assumptions, we can conclude that both <code>N</code> and <code>maxClock</code> are
integers. We add the type annotations:</p>
<pre><code class="language-tla">CONSTANT
    \* @type: Int;
    N,
    \* @type: Int;
    maxClock
</code></pre>
<p>Let's run the type checker once again:</p>
<pre><code class="language-sh">$ apalache-mc typecheck LamportMutexTyped.tla
...
 &gt; All expressions are typed
Type checker [OK]
</code></pre>
<p>Snowcat is happy, and so we are too!</p>
<h1><a class="header" href="#discussion" id="discussion">Discussion</a></h1>
<p>To see the complete code, check <a href="https://github.com/informalsystems/apalache/blob/main/test/tla/LamportMutexTyped.tla">LamportMutexTyped.tla</a>. We have added seven
type annotations for 184 lines of code. Not bad.</p>
<p>It was relatively easy to figure out the types of constants and variables in
our example, though it required some exploration of the specification.</p>
<p><em>As a rule, you always have to annotate constants and variables with types</em>.</p>
<p>Hence, we did not have to run the type checker seven times to see the error
messages.  The type annotations are useful on its own, since we do not have to
traverse the spec to figure out the types of constants and states. Our more
engineering-oriented peers find these annotations to be quite important.</p>
<p>Sometimes, the type checker cannot find a unique type of an expression. This
usually happens when you declare an operator of a parameter that can be: a
function, a tuple, a record, or a sequence (or a subset of these four types
that has at least two elements). For instance, here is a definition from
<a href="https://github.com/informalsystems/apalache/blob/main/test/tla/GameOfLifeTyped.tla">GameOfLifeTyped.tla</a>:</p>
<pre><code class="language-tla">Pos ==
    { &lt;&lt;x, y&gt;&gt;: x, y \in 1..N }
</code></pre>
<p>Although it is absolutely clear that <code>x</code> and <code>y</code> have the type <code>Int</code>,
the type of <code>&lt;&lt;x, y&gt;&gt;</code> is ambiguous. This expression can either be
a tuple <code>&lt;&lt;Int, Int&gt;&gt;</code>, or a sequence <code>Seq(Int)</code>. In this case, we have to
help the type checker by annotating the operator definition:</p>
<pre><code class="language-tla">\* @type: () =&gt; Set(&lt;&lt;Int, Int&gt;&gt;);
Pos ==
    {&lt;&lt;x, y&gt;&gt;: x, y \in 1..N}
</code></pre>
<p>Since it is common to have operators that take no arguments, Snowcat supports
the following syntax sugar for operators without arguments:</p>
<pre><code class="language-tla">\* @type: Set(&lt;&lt;Int, Int&gt;&gt;);
Pos ==
    {&lt;&lt;x, y&gt;&gt;: x, y \in 1..N}
</code></pre>
<h2><a class="header" href="#further-reading" id="further-reading">Further reading</a></h2>
<p>For more advanced type annotations, check the following examples:</p>
<ul>
<li><a href="https://github.com/informalsystems/apalache/blob/main/test/tla/CigaretteSmokersTyped.tla">CigaretteSmokersTyped.tla</a>,</li>
<li><a href="https://github.com/informalsystems/apalache/blob/main/test/tla/CarTalkPuzzleTyped.tla">CarTalkPuzzleTyped.tla</a>,</li>
<li><a href="https://github.com/informalsystems/apalache/blob/main/test/tla/QueensTyped.tla">QueensTyped.tla</a>.</li>
<li><a href="https://github.com/informalsystems/apalache/blob/main/test/tla/TwoPhaseTyped.tla">TwoPhaseTyped.tla</a>.</li>
</ul>
<p>We have not discussed type aliases, which are a more advanced feature of the
type checker. To learn about type aliases, see <a href="../HOWTOs/howto-write-type-annotations.html">HOWTO on writing type
annotations</a>.</p>
<p>If you are experiencing a problem with Snowcat, feel free to <a href="https://github.com/informalsystems/apalache/issues">open an issue</a>
or drop us a message on <a href="https://informal-systems.zulipchat.com/login/#narrow/stream/265309-apalache">Zulip chat</a>.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                        
                            <a rel="prev" href="../tutorials/entry-tutorial.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                        

                        
                            <a rel="next" href="../tutorials/pluscal-tutorial.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>
                        

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                
                    <a rel="prev" href="../tutorials/entry-tutorial.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                

                
                    <a rel="next" href="../tutorials/pluscal-tutorial.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
                
            </nav>

        </div>

        

        

        

        
        <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        

        

        
        <script src="../elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../searcher.js" type="text/javascript" charset="utf-8"></script>
        

        <script src="../clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="../book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        
        <script type="text/javascript" src=".././highlightjs-tlaplus/dist/tlaplus.min.js"></script>
        
        <script type="text/javascript" src=".././theme/highlightTla.js"></script>
        

        

    </body>
</html>
