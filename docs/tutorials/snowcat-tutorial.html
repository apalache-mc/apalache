<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Type Checker Tutorial - Apalache Documentation</title>
        
        


        <!-- Custom HTML head -->
        


        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        
        <link rel="icon" href="../favicon.svg">
        
        
        <link rel="shortcut icon" href="../favicon.png">
        
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        
        <link rel="stylesheet" href="../css/print.css" media="print">
        

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        
        <link rel="stylesheet" href="../fonts/fonts.css">
        

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        

        
        <!-- MathJax -->
        <script async type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
        
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="../index.html">Overview</a></li><li class="chapter-item expanded affix "><li class="part-title">Tutorials</li><li class="chapter-item expanded "><a href="../tutorials/snowcat-tutorial.html" class="active"><strong aria-hidden="true">1.</strong> Type Checker Tutorial</a></li><li class="chapter-item expanded affix "><li class="part-title">Apalache User Manual</li><li class="chapter-item expanded "><a href="../apalache/index.html"><strong aria-hidden="true">2.</strong> Introduction</a></li><li class="chapter-item expanded "><a href="../apalache/getting-started.html"><strong aria-hidden="true">3.</strong> Getting Started</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../apalache/apalache-or-tlc.html"><strong aria-hidden="true">3.1.</strong> Shall I use Apalache or TLC?</a></li><li class="chapter-item expanded "><a href="../apalache/system-reqs.html"><strong aria-hidden="true">3.2.</strong> System Requirements</a></li><li class="chapter-item expanded "><a href="../apalache/installation/index.html"><strong aria-hidden="true">3.3.</strong> Installation</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../apalache/installation/jvm.html"><strong aria-hidden="true">3.3.1.</strong> Prebuilt Packages</a></li><li class="chapter-item expanded "><a href="../apalache/installation/docker.html"><strong aria-hidden="true">3.3.2.</strong> Docker</a></li><li class="chapter-item expanded "><a href="../apalache/installation/source.html"><strong aria-hidden="true">3.3.3.</strong> Source</a></li></ol></li><li class="chapter-item expanded "><a href="../apalache/running.html"><strong aria-hidden="true">3.4.</strong> Running the Tool</a></li><li class="chapter-item expanded "><a href="../apalache/statistics.html"><strong aria-hidden="true">3.5.</strong> TLA+ Execution Statistics</a></li><li class="chapter-item expanded "><a href="../apalache/example.html"><strong aria-hidden="true">3.6.</strong> An Example TLA+ Specification</a></li><li class="chapter-item expanded "><a href="../apalache/parameters.html"><strong aria-hidden="true">3.7.</strong> Specification Parameters</a></li><li class="chapter-item expanded "><a href="../apalache/principles.html"><strong aria-hidden="true">3.8.</strong> Principles of Symbolic Model Checking with Apalache</a></li><li class="chapter-item expanded "><a href="../apalache/apalache-mod.html"><strong aria-hidden="true">3.9.</strong> The Apalache Module</a></li><li class="chapter-item expanded "><a href="../apalache/profiling.html"><strong aria-hidden="true">3.10.</strong> Profiling Your Specification</a></li><li class="chapter-item expanded "><a href="../apalache/theory.html"><strong aria-hidden="true">3.11.</strong> Five minutes of theory</a></li></ol></li><li class="chapter-item expanded "><a href="../apalache/tlc-config.html"><strong aria-hidden="true">4.</strong> TLC Configuration Files</a></li><li class="chapter-item expanded "><a href="../apalache/typechecker-snowcat.html"><strong aria-hidden="true">5.</strong> The Snowcat Type Checker</a></li><li class="chapter-item expanded "><a href="../apalache/features.html"><strong aria-hidden="true">6.</strong> Supported Features</a></li><li class="chapter-item expanded "><a href="../apalache/known-issues.html"><strong aria-hidden="true">7.</strong> Known Issues</a></li><li class="chapter-item expanded "><a href="../apalache/preprocessing.html"><strong aria-hidden="true">8.</strong> TLA+ Preprocessing</a></li><li class="chapter-item expanded "><a href="../apalache/tuning.html"><strong aria-hidden="true">9.</strong> Fine Tuning</a></li><li class="chapter-item expanded "><a href="../apalache/kera.html"><strong aria-hidden="true">10.</strong> KerA: kernel logic of actions</a></li><li class="chapter-item expanded "><a href="../apalache/assignments.html"><strong aria-hidden="true">11.</strong> Assignments in Apalache</a></li><li class="chapter-item expanded affix "><li class="part-title">HOWTOs</li><li class="chapter-item expanded "><a href="../HOWTOs/howto-write-type-annotations.html"><strong aria-hidden="true">12.</strong> How to write type annotations</a></li><li class="chapter-item expanded affix "><li class="part-title">TLA+ Language Manual for Engineers</li><li class="chapter-item expanded "><a href="../lang/index.html"><strong aria-hidden="true">13.</strong> Introduction</a></li><li class="chapter-item expanded "><a href="../lang/standard-operators.html"><strong aria-hidden="true">14.</strong> The standard operators of TLA+</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../lang/booleans.html"><strong aria-hidden="true">14.1.</strong> Booleans</a></li><li class="chapter-item expanded "><a href="../lang/control-and-nondeterminism.html"><strong aria-hidden="true">14.2.</strong> Control And Nondeterminism</a></li><li class="chapter-item expanded "><a href="../lang/conditionals.html"><strong aria-hidden="true">14.3.</strong> Conditionals</a></li><li class="chapter-item expanded "><a href="../lang/integers.html"><strong aria-hidden="true">14.4.</strong> Integers</a></li><li class="chapter-item expanded "><a href="../lang/sets.html"><strong aria-hidden="true">14.5.</strong> Sets</a></li><li class="chapter-item expanded "><a href="../lang/logic.html"><strong aria-hidden="true">14.6.</strong> Logic</a></li><li class="chapter-item expanded "><a href="../lang/functions.html"><strong aria-hidden="true">14.7.</strong> Functions</a></li><li class="chapter-item expanded "><a href="../lang/records.html"><strong aria-hidden="true">14.8.</strong> Records</a></li><li class="chapter-item expanded "><a href="../lang/tuples.html"><strong aria-hidden="true">14.9.</strong> Tuples</a></li><li class="chapter-item expanded "><a href="../lang/sequences.html"><strong aria-hidden="true">14.10.</strong> Sequences</a></li><li class="chapter-item expanded "><div><strong aria-hidden="true">14.11.</strong> Bags</div></li></ol></li><li class="chapter-item expanded "><a href="../lang/user-operators.html"><strong aria-hidden="true">15.</strong> User-defined operators</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../lang/user/top-level-operators.html"><strong aria-hidden="true">15.1.</strong> Top-level operator definitions</a></li><li class="chapter-item expanded "><a href="../lang/user/let-in.html"><strong aria-hidden="true">15.2.</strong> LET-IN definitions</a></li><li class="chapter-item expanded "><a href="../lang/user/higher-order-operators.html"><strong aria-hidden="true">15.3.</strong> Higher-order operators definitions</a></li><li class="chapter-item expanded "><a href="../lang/user/lambdas.html"><strong aria-hidden="true">15.4.</strong> Anonymous operator definitions</a></li><li class="chapter-item expanded "><a href="../lang/user/recursive-operators.html"><strong aria-hidden="true">15.5.</strong> Recursive operator definitions</a></li><li class="chapter-item expanded "><a href="../lang/user/local-operators.html"><strong aria-hidden="true">15.6.</strong> Local operator definitions</a></li><li class="chapter-item expanded "><a href="../lang/user/recursive-functions.html"><strong aria-hidden="true">15.7.</strong> Recursive functions</a></li></ol></li><li class="chapter-item expanded "><div><strong aria-hidden="true">16.</strong> Modules, Extends, and Instances</div></li><li class="chapter-item expanded affix "><li class="part-title">Idiomatic TLA+</li><li class="chapter-item expanded "><a href="../idiomatic/index.html"><strong aria-hidden="true">17.</strong> Introduction</a></li><li class="chapter-item expanded "><a href="../idiomatic/000keep-minimum-state-variables.html"><strong aria-hidden="true">18.</strong> Keep state variables to the minimum</a></li><li class="chapter-item expanded "><a href="../idiomatic/001assignments.html"><strong aria-hidden="true">19.</strong> Update state variables with assignments</a></li><li class="chapter-item expanded "><a href="../idiomatic/002primes.html"><strong aria-hidden="true">20.</strong> Apply primes only to state variables</a></li><li class="chapter-item expanded affix "><li class="part-title">Design Documents</li><li class="chapter-item expanded "><a href="../adr/002adr-types.html"><strong aria-hidden="true">21.</strong> ADR-002: types and type annotations</a></li><li class="chapter-item expanded "><a href="../adr/004adr-annotations.html"><strong aria-hidden="true">22.</strong> ADR-004: code annotations</a></li><li class="chapter-item expanded "><a href="../adr/006rfc-unit-testing.html"><strong aria-hidden="true">23.</strong> RFC-006: unit tests and property-based tests</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                        
                    </div>

                    <h1 class="menu-title">Apalache Documentation</h1>

                    <div class="right-buttons">
                        
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        
                        
                        <a href="https://github.com/informalsystems/apalache" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>
                        
                    </div>
                </div>

                
                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" name="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1><a class="header" href="#tutorial-on-the-snowcat-type-checker" id="tutorial-on-the-snowcat-type-checker">Tutorial on the Snowcat‚ùÑüê± Type Checker</a></h1>
<p>In this tutorial, we introduce the Snowcat ‚ùÑ üê± type checker
We give concrete steps on running the type checker and
annotating a specification with types.</p>
<h2><a class="header" href="#related-documents" id="related-documents">Related documents</a></h2>
<ul>
<li><a href="../adr/002adr-types.html">ADR002</a> that introduces Type System 1, which is used by Snowcat.</li>
<li>A more technical <a href="../HOWTOs/howto-write-type-annotations.html">HOWTO on writing type annotations</a>.</li>
<li><a href="../adr/004adr-annotations.html">ADR004</a> that introduces Java-like annotations in TLA+ comments.</li>
</ul>
<h2><a class="header" href="#setup" id="setup">Setup</a></h2>
<p>We assume that you have Apalache installed. If not, check the manual page on
<a href="../apalache/installation/index.html">Apalache installation</a>. The minimal required version is 0.15.0.</p>
<h2><a class="header" href="#running-example-two-phase-commit" id="running-example-two-phase-commit">Running example: Two-phase commit</a></h2>
<p>As a running example, we are using the well-understood specification of
<a href="https://github.com/tlaplus/Examples/blob/master/specifications/transaction_commit">Two-phase commit</a> by <a href="https://lamport.azurewebsites.net/">Leslie Lamport</a> (written by <a href="https://members.loria.fr/Stephan.Merz/">Stephan Merz</a>). We
recommend to reproduce the steps in this tutorial. So, go ahead and download
two specification files: <a href="https://github.com/tlaplus/Examples/blob/911dac1462344337940779a797a5f329a77be98c/specifications/transaction_commit/TwoPhase.tla">TwoPhase.tla</a> and <a href="https://github.com/tlaplus/Examples/blob/911dac1462344337940779a797a5f329a77be98c/specifications/transaction_commit/TCommit.tla">TCommit.tla</a>.</p>
<h2><a class="header" href="#step-1-running-snowcat" id="step-1-running-snowcat">Step 1: Running Snowcat</a></h2>
<p>Before we start writing any type annotations, let's run the type checker and
see, whether it complains:</p>
<pre><code class="language-sh">$ apalache typecheck TwoPhase.tla
</code></pre>
<p>The tool output is a bit verbose. Below, you can see the important lines of the
output:</p>
<pre><code>...
PASS #1: TypeCheckerSnowcat
 &gt; Running Snowcat .::.
[TwoPhase.tla:51:30-51:31]: Undefined name RM. Introduce a type annotation.
 &gt; Snowcat asks you to fix the types. Meow.
... 
</code></pre>
<h2><a class="header" href="#step-2-annotating-rm" id="step-2-annotating-rm">Step 2: Annotating RM</a></h2>
<p>In Step 1, Snowcat complained about the name <code>RM</code>. The reason
for that is very simple: Snowcat does type analysis for each declaration in
isolation. Hence, it failed, as soon as it met a reference to the constant
<code>RM</code> in the definition of <code>Message</code>:</p>
<pre><code class="language-tla">CONSTANT RM \* The set of resource managers
...

Message ==
  ...
  [type : {&quot;Prepared&quot;}, rm : RM]  \cup  [type : {&quot;Commit&quot;, &quot;Abort&quot;}]
</code></pre>
<p>Indeed, we have not introduced a type annotation for the constant <code>RM</code>, so the
type checker cannot use any meaningful type in the context of the above
expression.</p>
<p>From the comment next to the declaration of <code>RM</code>, we see that <code>RM</code> is supposed
to be a set of resource managers. We have plenty of choices here of what a
resource manager could be. Let's keep it simple and say that a resource manager
is simply a name. Hence, we say that <code>RM</code> is a set of strings. Let's add a 
type annotation:</p>
<pre><code class="language-tla">CONSTANT
    \* @type: Set(Str);
    RM \* The set of resource managers
</code></pre>
<p>Note that we had to put the annotation between the keyword <code>CONSTANT</code> and the
identifier <code>RM</code>. We used the one-line TLA+ comment: <code>\* @type: ...;</code>.
Alternatively, we could use the multi-line comment: <code>(* @type: Set(Str); *)</code>.
Importantly, the type annotation should end with a semi-colon: <code>;</code>.</p>
<p><strong>Warning</strong>. If you want to write a type annotation on multiple lines, write it
in a multi-line comment <code>(* ... *)</code> instead of starting multiple lines with a
single-line comment <code>\* ...</code>. See <a href="https://github.com/informalsystems/apalache/issues/718">issue
718</a>.</p>
<h2><a class="header" href="#step-3-running-snowcat-again" id="step-3-running-snowcat-again">Step 3: Running Snowcat again</a></h2>
<p>Having introduced the type annotation for <code>RM</code>, let's run the type checker again:</p>
<pre><code class="language-sh">$ apalache typecheck TwoPhase.tla
</code></pre>
<p>Snowcat does not complain about <code>RM</code> anymore. Now we get another message:</p>
<pre><code>[TwoPhase.tla:68:6-68:12]: Undefined name rmState. Introduce a type annotation.
</code></pre>
<h2><a class="header" href="#step-4-annotating-rmstate" id="step-4-annotating-rmstate">Step 4: Annotating rmState</a></h2>
<p>Similar to Step 2, we are missing a type annotation. This time the type checker
complains about the variable <code>rmState</code>:</p>
<pre><code class="language-tla">VARIABLES
  rmState,       \* $rmState[rm]$ is the state of resource manager RM.
</code></pre>
<p>We can get a hint about the type of <code>rmState</code> from the type invariant
<code>TPTypeOK</code>. It should be a function that, given a resource manager, produces
one of the following strings: <code>&quot;working&quot;</code>, <code>&quot;prepared&quot;</code>, <code>&quot;committed&quot;</code>,
<code>&quot;aborted&quot;</code>. So we need the function type: <code>Str -&gt; Str</code>. Add the following
type annotation:</p>
<pre><code class="language-tla">VARIABLES
  \* @type: Str -&gt; Str;
  rmState,       \* $rmState[rm]$ is the state of resource manager RM.
</code></pre>
<h2><a class="header" href="#step-5-getting-one-more-type-error-by-snowcat" id="step-5-getting-one-more-type-error-by-snowcat">Step 5: Getting one more type error by Snowcat</a></h2>
<p>Guess what? Run the type checker again:</p>
<pre><code class="language-sh">$ apalache typecheck TwoPhase.tla
</code></pre>
<p>Snowcat does not complain about <code>rmState</code> anymore. But we are not done yet:</p>
<pre><code>[TwoPhase.tla:70:6-70:12]: Undefined name tmState. Introduce a type annotation.
</code></pre>
<h2><a class="header" href="#step-6-annotating-tmstate" id="step-6-annotating-tmstate">Step 6: Annotating tmState</a></h2>
<p>This time we need a type annotation for the variable <code>tmState</code>. By inspecting
<code>TPTypeOK</code>, we see that <code>tmState</code> is just a string. Add the following type
annotation:</p>
<pre><code class="language-tla">VARIABLES
  (* ... *)
  \* @type: Str;  
  tmState,       \* The state of the transaction manager.
</code></pre>
<h2><a class="header" href="#step-7-running-snowcat-to-see-another-error" id="step-7-running-snowcat-to-see-another-error">Step 7: Running Snowcat to see another error</a></h2>
<p>Run the type checker again:</p>
<pre><code class="language-sh">$ apalache typecheck TwoPhase.tla
</code></pre>
<p>You must have guessed that the type checker complains about the variable
<code>tmPrepared</code>. Indeed, it just needs annotations for all CONSTANTS and
VARIABLES:</p>
<pre><code>[TwoPhase.tla:72:6-72:15]: Undefined name tmPrepared. Introduce a type annotation.
</code></pre>
<h2><a class="header" href="#step-8-annotating-tmprepared" id="step-8-annotating-tmprepared">Step 8: Annotating tmPrepared</a></h2>
<p>At this step, we have to annotate <code>tmPrepared</code>. Let's have a look at the comment
next to the declaration of <code>tmPrepared</code>:</p>
<pre><code class="language-tla">VARIABLES
  ...
  tmPrepared,    \* The set of RMs from which the TM has received $&quot;Prepared&quot;$
                 \* messages.
</code></pre>
<p>Hence, <code>tmPrepared</code> is a set of resource managers. This is what we write as a
type annotation:</p>
<pre><code class="language-tla">VARIABLES
  (* ... *)
  \* @type: Set(Str);
  tmPrepared,    \* The set of RMs from which the TM has received $&quot;Prepared&quot;$
                 \* messages.
</code></pre>
<h2><a class="header" href="#step-9-running-snowcat-again" id="step-9-running-snowcat-again">Step 9: Running Snowcat again</a></h2>
<p>You know that we have to run the type checker again:</p>
<pre><code class="language-sh">$ apalache typecheck TwoPhase.tla
</code></pre>
<p>It is no surprise that it complains about the variable <code>msgs</code> now:</p>
<pre><code>[TwoPhase.tla:74:6-74:9]: Undefined name msgs. Introduce a type annotation.
</code></pre>
<h2><a class="header" href="#step-10-annotating-msgs" id="step-10-annotating-msgs">Step 10: Annotating msgs</a></h2>
<p>In the previous steps, it was quite easy to annotate variables. We would just
look at how the variable is used, or read the comments, and add a type annotation.
Figuring out the type of <code>msgs</code> is a bit harder.</p>
<p>Let's look at the definitions of <code>Messages</code> and <code>TPTypeOK</code>:</p>
<pre><code class="language-tla">Message ==
  ...
  [type : {&quot;Prepared&quot;}, rm : RM]  \cup  [type : {&quot;Commit&quot;, &quot;Abort&quot;}]

TPTypeOK ==  
  ...  
  /\ msgs \subseteq Message
</code></pre>
<p>Now you should be able to see that <code>msgs</code> is a set that may contain three
kinds of records:</p>
<ol>
<li>The record <code>[type |-&gt; &quot;Commit&quot;]</code>,</li>
<li>The record <code>[type |-&gt; &quot;Abort&quot;]</code>,</li>
<li>A record <code>[type |-&gt; &quot;Prepared&quot;, rm |-&gt; r]</code>, for some <code>r \in RM</code>.</li>
</ol>
<p>This looks like an issue for the type checker, as it always requires
the set elements to have the same type. However, the type checker
did not complain about the expressions in <code>Message</code> and <code>TPTypeOK</code>. Why?</p>
<p>Actually, the type checker allows records to be generalized to a type that
contains additional fields. In the above definition of <code>Messages</code>, the set of
records <code>[type: {&quot;Prepared&quot;}, rm: RM]</code> has the type <code>Set([type: Str, rm: Str])</code>.  (Note that the record has the field called &quot;type&quot;, which has nothing
to do with our types.) Likewise, the set of records <code>[type: {&quot;Commit&quot;, &quot;Abort&quot;}]</code> has the type <code>Set([type: Str])</code>. Both of these types can be unified
to the common type:</p>
<pre><code>Set([type: Str, rm: Str])
</code></pre>
<p>The above type is actually what we need for the variable <code>msgs</code>. Let's annotate
the variable with this type:</p>
<pre><code class="language-tla">VARIABLES
  (* ... *)
  \* @type: Set([type: Str, rm: Str]);
  msgs
</code></pre>
<h2><a class="header" href="#step-11-running-snowcat-and-seeing-no-errors" id="step-11-running-snowcat-and-seeing-no-errors">Step 11: Running Snowcat and seeing no errors</a></h2>
<p>Let's see whether Snowcat is happy about our types now:</p>
<pre><code class="language-sh">$ apalache typecheck TwoPhase.tla
</code></pre>
<p>The type checker is happy. It has computed the types of all expressions:</p>
<pre><code> &gt; Running Snowcat .::.
 &gt; Your types are great!
 &gt; All expressions are typed
</code></pre>
<h1><a class="header" href="#discussion" id="discussion">Discussion</a></h1>
<p>To see the complete code, check <a href="./TwoPhase.tla">TwoPhase.tla</a>. Note that we
have not touched the file <code>TCommit.tla</code> at all! The type checker has figured
out all the types in it by itself. We have added five type annotations for 248
lines of code. Not bad.</p>
<p>It was quite easy to figure out the types of constants and variables in our
example. As a rule, you always have to annotate constants and variables with
types. Hence, we did not have to run the type checker five times to see the
error messages.</p>
<p>Sometimes, the type checker cannot find a unique type of an expression. This
usually happens when you declare an operator of a parameter that can be: a
function, a tuple, a record, or a sequence (or a subset of these four types
that has at least two elements). For instance, here is a definition from
<a href="https://github.com/informalsystems/apalache/blob/d5138a33fce3d77abc07a39bfb4f448942e6f641/test/tla/GameOfLifeTyped.tla">GameOfLifeTyped.tla</a>:</p>
<pre><code class="language-tla">Pos ==
    {&lt;&lt;x, y&gt;&gt;: x, y \in 1..N}
</code></pre>
<p>Although it is absolutely clear that <code>x</code> and <code>y</code> have the type <code>Int</code>,
the type of <code>&lt;&lt;x, y&gt;&gt;</code> is ambiguous. This expression can either be
a tuple <code>&lt;&lt;Int, Int&gt;&gt;</code>, or a sequence <code>Seq(Int)</code>. In this case, we have to
help the type checker by annotating the operator definition:</p>
<pre><code class="language-tla">\* @type: () =&gt; Set(&lt;&lt;Int, Int&gt;&gt;);
Pos ==
    {&lt;&lt;x, y&gt;&gt;: x, y \in 1..N}
</code></pre>
<p>Since it is common to have operators that take no arguments, Snowcat supports
the following syntax sugar:</p>
<pre><code class="language-tla">\* @type: Set(&lt;&lt;Int, Int&gt;&gt;);
Pos ==
    {&lt;&lt;x, y&gt;&gt;: x, y \in 1..N}
</code></pre>
<h2><a class="header" href="#further-reading" id="further-reading">Further reading</a></h2>
<p>For more advanced type annotations, check the following examples:</p>
<ul>
<li><a href="https://github.com/informalsystems/apalache/blob/d5138a33fce3d77abc07a39bfb4f448942e6f641/test/tla/CigaretteSmokersTyped.tla">CigaretteSmokersTyped.tla</a>,</li>
<li><a href="https://github.com/informalsystems/apalache/blob/d5138a33fce3d77abc07a39bfb4f448942e6f641/test/tla/CarTalkPuzzleTyped.tla">CarTalkPuzzleTyped.tla</a>,</li>
<li><a href="https://github.com/informalsystems/apalache/blob/d5138a33fce3d77abc07a39bfb4f448942e6f641/test/tla/FunctionsTyped.tla">FunctionsTyped.tla</a>,</li>
<li><a href="https://github.com/informalsystems/apalache/blob/d5138a33fce3d77abc07a39bfb4f448942e6f641/test/tla/QueensTyped.tla">QueensTyped.tla</a>.</li>
</ul>
<p>We have not discussed type aliases, which are a more advanced feature of the
type checker. To learn about type aliases, see <a href="../HOWTOs/howto-write-type-annotations.html">HOWTO on writing type
annotations</a>.</p>
<p>If you are experiencing a problem with Snowcat, feel free to <a href="https://github.com/informalsystems/apalache/issues">open an issue</a>
or drop us a message on <a href="https://informal-systems.zulipchat.com/login/#narrow/stream/265309-apalache">Zulip chat</a>.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                        
                            <a rel="prev" href="../index.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                        

                        
                            <a rel="next" href="../apalache/index.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>
                        

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                
                    <a rel="prev" href="../index.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                

                
                    <a rel="next" href="../apalache/index.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
                
            </nav>

        </div>

        

        

        

        
        <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        

        

        
        <script src="../elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../searcher.js" type="text/javascript" charset="utf-8"></script>
        

        <script src="../clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="../book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        

        

    </body>
</html>
