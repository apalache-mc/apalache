#!/bin/bash

# This script is used as the entrypoint for running apalache inside of the
# docker container defined in ../Dockerfile

# Create a user and group matching the invoking user
# this is critical to avoid generating files with bad permissions
USER_ID=${USER_ID:-1000}
GROUP_ID=${GROUP_ID:-1000}
groupadd --gid "$GROUP_ID" --non-unique apalache
useradd --create-home --shell /bin/bash --uid "$USER_ID" --non-unique --gid "$GROUP_ID" apalache

echo 'Assuming you bind-mounted your local directory into /var/apalache...'
cd /var/apalache
if [ "$(ls -A *.tla 2>/dev/null)" == "" ]; then
      echo 'WARNING: no .tla files found in /var/apalache'
fi
# Run apalache as the set user
exec sudo --preserve-env=PATH --set-home -u apalache env /opt/apalache/bin/apalache-mc $@
